# [broker, worker] The domains that should be accepted by clients and for which matching WireGuard interfaces exist
domains:
  - ffmuc_muc_cty
  - ffmuc_muc_nord
  - ffmuc_muc_ost
  - ffmuc_muc_sued
  - ffmuc_muc_west
  - ffmuc_welt
  - ffwert_city
# [broker, worker] The prefix is trimmed from the domain name and replaced with 'wg-' and 'vx-'
# to calculate the WireGuard and VXLAN interface names
domain_prefixes:
  - ffmuc_
  - ffdon_
  - ffwert_
# [broker] The dict of workers mapping their hostname to their respective weight (for weighted peer distribution) and PoP (for multi-tunnel support, esp. in Parker)
workers:
  gw04.in.ffmuc.net:
    weight: 30
    pop: vie01
  gw05.in.ffmuc.net:
    weight: 30
    pop: vie01
  gw06.in.ffmuc.net:
    weight: 20
    pop: muc01
  gw07.in.ffmuc.net:
    weight: 20
    pop: muc01
# [broker] how much peers above the target value a worker may have (in percent rel. to the target value) to let clients stick to their current worker.
# Default: 10
# Example: with a value of '10', an active peer count 170 and target of 150 of 'Worker A',
# a requesting client who is currently connected to 'Worker A' will get redirected to a new worker with lower peer count.
# 10% * 150 = 15 -> (170-150) > 15
sticky_worker_tolerance: 15
# [worker] The external hostname of this worker
externalName: gw04.ext.ffmuc.net
# [broker, worker]
parker:
  # Enable Parker support. The broker will still handle non-Parker in the same instance, the worker however will disable non-Parker support in this case.
  enabled: False
  # only 464xlat=True is currently properly supported
  464xlat: True
  # The retry interval in seconds for nodes to recontact the broker to check for new configuration.
  retry_interval: 120
  # The keepalive interval in seconds the nodes should set for the WireGuard tunnel.
  wg_keepalive: 25
  # ipam must be either of json or netbox
  ipam: netbox
  prefixes:
    ipv4:
      # Specify either length and netbox_filter if 464xlat=False, or clat_subnet if 464xlat=True
      length: 22
      clat_subnet: 10.80.96.0/22
      # A mapping of filters for Netbox to find the parent prefix to allocate node prefixes from if 464xlat=False.
      # Needs to match one and only one IPv4 prefix.
      # Prefix is loaded only once on startup, so if you want to switch the prefix, you need to restart wgkex.
      # E.g. {id: 9999} or {prefix: '10.80.0.0/16'} or {description: Freifunk, role: NodePrefixes} or {cf_my_custom_field: 'Some Value'}
      # See https://demo.netbox.dev/api/schema/swagger-ui/#/ipam/ipam_prefixes_list and https://netboxlabs.com/docs/netbox/reference/filtering/ for filtering syntax
      netbox_filter:
        role: freifunk-net
      # Optionally specify additional NetBox data to add to new prefixes, like tags or a role.
      # See the POST request body scheme at https://demo.netbox.dev/api/schema/swagger-ui/#/ipam/ipam_prefixes_available_prefixes_create for supported fields.
      netbox_additional_data:
        tags:
          - 123 # ID of a tag
          - slug: node-prefix # another tag uniquely identified through its slug
    ipv6:
      # This should normally be 64 if 464xlat=False, or 63 if 464xlat=True
      length: 63
      # See parker.prefixes.ipv4.netbox_filter
      netbox_filter: {}
      # See parker.prefixes.ipv4.netbox_additional_data
      netbox_additional_data: {}

# [broker]
broker_signing_key: ''
# [broker] netbox connection details
# Note: you can restrict the user for wgkex to "IPAM > Prefix" object types
netbox:
  # URL for your NetBox instance, without the "/api" path
  url: http://localhost:8000
  api_key: SECRET
# [broker, worker] MQTT connection informations
mqtt:
  broker_url: broker.hivemq.com
  broker_port: 1883
  username: user
  password: SECRET
  keepalive: 5
  tls: False
# [broker]
broker_listen:
  host: 0.0.0.0
  port: 5000
# [broker, worker]
logging_config:
  formatters:
    standard:
      format: '%(asctime)s,%(msecs)d %(levelname)-8s [%(filename)s:%(lineno)d] %(message)s'
  handlers:
    console:
      class: logging.StreamHandler
      formatter: standard
  root:
    handlers:
      - console
    level: DEBUG
  version: 1
